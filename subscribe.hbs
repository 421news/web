{{!< default}}

    <link href="{{asset "css/suscribite.css"}}" rel="stylesheet" type="text/css">
    <div class="page-wrapper">
      {{> "general-styling"}}
      {{> "site-nav-en"}}

      <!-- Formulario de suscripcion -->
      <div class="subscription-section">
        <div class="global-container">
          <div class="pv-huge">
            <div class="text-center">
              <h2 class="title">Subscribe to 421</h2>
              <p class="subtitle">Choose the type of subscrition you prefer</p>
            </div>

            <div class="subscription-options-wrapper">
              <div class="paid-subs">
                <!-- Opcion Wizard Anual -->
                <div class="subscription-option premium" id="wizard-annual-option">
                  <h3>Wizard Annual</h3>
                  <div class="price">
                    <b>$100USD</b>
                    <div>
                      <div class="striked-price">
                        $120USD
                      </div>
                      <div>annual</div>
                    </div>
                  </div>
                  <p class="savings">¡Save 2 months!</p>
                  <ul class="features">
                    <li>All benefits of Wizard Plan</li>
                    <li>2 months discount</li>
                  </ul>
                  <a href="https://buy.stripe.com/00wcN67KUaO0056cBIeUU01">
                    <button class="select-plan-btn premium-btn" data-plan="wizard-yearly">
                      Select
                    </button>
                  </a>
                </div>

                <!-- Opcion Wizard Mensual -->
                <div class="subscription-option" id="wizard-monthly-option" style="margin: 10px 0">
                  <h3 style="font-size: 2rem; font-style: normal">Wizard</h3>
                  <div
                    style="display: flex; gap: 10px; align-items: center;"
                    class="price"
                  >
                    <b style="font-size: 2rem;">$10USD</b>
                    <div>
                      <div>monthly</div>
                    </div>
                  </div>
                  <ul class="features">
                    <li>Monthly premium newsletter</li>
                    <li>Digital 421 Magazine</li>
                    <li>AFK Events</li>
                  </ul>
                  <a href="https://buy.stripe.com/00weVeaX6cW805659geUU00">
                    <button class="select-plan-btn">
                      Select
                    </button>
                  </a>
                </div>
              </div>

              <!-- Opcion Goblin (Gratis) -->
              <a href="#/portal/signup">
                <div class="subscription-option">
                  <h3>Goblin</h3>
                  <ul class="features">
                    <li>Receive articles via mail</li>
                  </ul>
                  <button class="select-plan-btn" data-plan="goblin">
                    Select
                  </button>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>

    <!-- FILE BROWSER NAVIGATION -->
    <div class="global-container pt-small pb-small">
      {{> "file-browser-en"}}
    </div>
      {{> "site-footer" lang="en"}}
    </div>

    <!-- SCRIPTS -->
    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=6669c61faddc5cdc1cf55c96" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const modeSwitchButton = document.getElementById("mode-switch");
        const bodyElement = document.querySelector(".body");

        // Check and apply user preference from localStorage
        if (localStorage.getItem("lightMode") === "enabled") {
          bodyElement.classList.add("light-mode");
          updateDivBorders("#121212");
        }

        modeSwitchButton.addEventListener("click", function() {
          bodyElement.classList.toggle("light-mode");
          
          if (bodyElement.classList.contains("light-mode")) {
            localStorage.setItem("lightMode", "enabled");
            updateDivBorders("#121212");
          } else {
            localStorage.setItem("lightMode", "disabled");
            updateDivBorders("");
          }
        });

        function updateDivBorders(color) {
          document.querySelectorAll("div").forEach(function(div) {
            div.style.borderColor = color;
          })
        }
      })
    </script>
    <!-- Script para el formulario de suscripcion -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // Elementos del DOM
        const planButtons = document.querySelectorAll(".select-plan-btn");
        const formContainer = document.getElementById("subscription-form-container");
        const subTypeInput = document.getElementById("subType");
        const selectedPlanTitle = document.getElementById("selected-plan-title");
        const subscriptionForm = document.getElementById("subscription-form");
        const formMessage = document.getElementById("form-message");

        // Manejar seleccion de plan
        planButtons.forEach(function(button) {
          button.addEventListener("click", function() {
            const plan = this.getAttribute("data-plan");

            if (plan === "goblin") return;

            // Actualizar form con el plan seleccionado
            subTypeInput.value = plan;

            // Actualizar titulo con el plan seleccionado
            let planDisplay = "";
            if (plan === "goblin") {
              planDisplay = "Goblin (Gratis)";
            } else if (plan === "wizard-monthly") {
              planDisplay = "Wizard Mensual";
            } else if (plan === "wizard-yearly") {
              planDisplay = "Wizard Anual";
            }

            selectedPlanTitle.textContent = `Complete su suscripción: ${planDisplay}`;

            // Mostrar el form
            formContainer.style.display = "block";

            // Desplazarse al formulario
            formContainer.scrollIntoView({ behavior: "smooth" });
          });
        });

        // Manejar el envio del form
        subscriptionForm.addEventListener("submit", function(event) {
          event.preventDefault();

          // recopilar datos del form
          const formData = {
            formSubType: subTypeInput.value,
            formName: document.getElementById("name").value,
            formEmail: document.getElementById("email").value
          };

          // mostrar msj de carga
          formMessage.textContent = "Procesando la solicitud...";
          formMessage.className = "form-message";

          // enviar datos al servicio externo
          fetch("https://mercado-pago-ghost.onrender.com/subscribe", {
            method: "POST",
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
          })
          .then(function(response) {
            if (!response.ok) {
              throw new Error('Error en la respuesta del servidor');
            }
            return response.json();
          })
          .then(function(data) {
            if (data.success && data.redirectUrl) {
              // redirigir a la pagina de mercadopago
              window.location.href = data.redirectUrl;
            } else {
              throw new Error(data.message || "Error al procesar la suscripción")
            }
          })
          .catch(function(error) {
            formMessage.textContent = 'Ha ocurrido un error al procesar tu suscripción. Por favor, intenta nuevamente.';
            formMessage.className = 'form-message error';
            console.error('Error:', error);
          })
        });
      });
    </script>
