<header class="site-header">
  <div class="global-container">

    {{!-- Desktop nav --}}
    <nav class="site-nav" aria-label="Main navigation">
      <a href="/en/" class="site-logo">
        <img src='{{asset "images/frame-2.svg"}}' alt="421" />
      </a>

      <div class="nav-links">
        <a href="/en/tag/culture" class="nav-link">Culture</a>
        <a href="/en/tag/tech" class="nav-link">Tech</a>
        <a href="/en/tag/games" class="nav-link">Games</a>
        <a href="/en/tag/real-life" class="nav-link">Real life</a>
        <a href="/en/routes" class="nav-link">Routes</a>
        <div class="nav-dropdown">
          <a href="/en/canon" class="nav-link">Canon â–¾</a>
          <div class="nav-dropdown-menu">
            <a href="/es/revista-421">Magazine</a>
            <a href="/es/pitcheale-a-421/">Pitch us</a>
            <a href="/en/rss/">RSS</a>
          </div>
        </div>
      </div>

      <div class="nav-actions">
        <a href="/en/subscribe/" class="nav-subscribe-btn">Subscribe</a>
        <button class="nav-icon-btn" data-ghost-search aria-label="Search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
        <a
          href="/es/"
          class="nav-icon-btn"
        >
          <img src='{{asset "images/usa-flag.svg"}}' alt="" class="nav-flag" />
          EN
        </a>
        <button id="mode-switch" class="nav-icon-btn" aria-label="Toggle theme">
          <img src='{{asset "images/moon.svg"}}' class="is-moon" alt="Dark mode" />
          <img src='{{asset "images/sun.svg"}}' class="is-sun" alt="Light mode" style="display:none;" />
        </button>
      </div>
    </nav>

    {{!-- Mobile nav bar --}}
    <div class="site-nav-mobile">
      <div class="nav-mobile-left">
        <button id="nav-mobile-trigger" class="nav-icon-btn" aria-label="Menu">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
        <a
          href="/es/"
          class="nav-icon-btn"
        >
          <img src='{{asset "images/usa-flag.svg"}}' alt="" class="nav-flag" />
        </a>
      </div>
      <a href="/en/" class="site-logo site-logo--mobile">
        <img src='{{asset "images/frame-2.svg"}}' alt="421" />
      </a>
      <div class="nav-mobile-right">
        <button id="mode-switch-mobile" class="nav-icon-btn" aria-label="Toggle theme">
          <img src='{{asset "images/moon.svg"}}' class="is-moon-m" alt="" />
          <img src='{{asset "images/sun.svg"}}' class="is-sun-m" alt="" style="display:none;" />
        </button>
        <button class="nav-icon-btn" data-ghost-search aria-label="Search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
      </div>
    </div>
  </div>

  {{!-- Mobile expanded menu --}}
  <nav id="nav-mobile" class="nav-mobile">
    <a href="/en/tag/culture">Culture</a>
    <a href="/en/tag/tech">Tech</a>
    <a href="/en/tag/games">Games</a>
    <a href="/en/tag/real-life">Real life</a>
    <a href="/en/routes">Routes</a>
    <a href="/en/canon">Canon</a>
    <a href="/es/revista-421" class="nav-mobile-sub">Magazine</a>
    <a href="/es/pitcheale-a-421/" class="nav-mobile-sub">Pitch us</a>
    <a href="/en/subscribe/" class="nav-mobile-subscribe">Subscribe</a>
  </nav>
</header>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Mobile menu toggle
    var mobileTrigger = document.getElementById("nav-mobile-trigger");
    var mobileMenu = document.getElementById("nav-mobile");
    if (!mobileTrigger || !mobileMenu) return;
    mobileMenu.style.display = "none";

    function toggleMobileMenu(e) {
      e.stopPropagation();
      if (mobileMenu.style.display === "none") {
        mobileTrigger.classList.add("is-open");
        mobileMenu.style.display = "flex";
      } else {
        mobileTrigger.classList.remove("is-open");
        mobileMenu.style.display = "none";
      }
    }

    if ('ontouchstart' in window) {
      mobileTrigger.addEventListener("touchstart", toggleMobileMenu, { passive: false });
    } else {
      mobileTrigger.addEventListener("click", toggleMobileMenu);
    }

    // Active link highlighting
    var currentPath = window.location.pathname;
    document.querySelectorAll('.nav-link, .nav-mobile a:not(.nav-mobile-subscribe)').forEach(function(link) {
      var href = link.getAttribute('href');
      if (href && href !== '/en/' && currentPath.startsWith(href)) {
        link.classList.add('is-active');
      }
    });

    // Smart language switch: go to ES equivalent of current page
    var esUrl = '/es/';
    var esMeta = document.querySelector('meta[name="spanish-version"]');
    if (esMeta && esMeta.content) {
      esUrl = '/es/' + esMeta.content + '/';
    } else {
      var langMap = {
        '/en/': '/es/',
        '/en/tag/culture/': '/es/tag/cultura/',
        '/en/tag/tech/': '/es/tag/tecnologia/',
        '/en/tag/games/': '/es/tag/juegos/',
        '/en/tag/real-life/': '/es/tag/vida-real/',
        '/en/routes/': '/es/rutas/',
        '/en/canon/': '/es/canon/',
        '/en/subscribe/': '/es/suscribite/'
      };
      var path = currentPath.replace(/\/?$/, '/');
      if (langMap[path]) esUrl = langMap[path];
    }
    document.querySelectorAll('a[href="/es/"]').forEach(function(a) {
      if (a.closest('.nav-actions') || a.closest('.nav-mobile-left')) a.href = esUrl;
    });

    // Sync mobile mode-switch with desktop
    var mobileSwitch = document.getElementById('mode-switch-mobile');
    var desktopSwitch = document.getElementById('mode-switch');
    if (mobileSwitch && desktopSwitch) {
      mobileSwitch.addEventListener('click', function(e) {
        e.preventDefault();
        desktopSwitch.click();
        var sunD = desktopSwitch.querySelector('.is-sun');
        var moonD = desktopSwitch.querySelector('.is-moon');
        var sunM = mobileSwitch.querySelector('.is-sun-m');
        var moonM = mobileSwitch.querySelector('.is-moon-m');
        if (sunD && moonD && sunM && moonM) {
          sunM.style.display = sunD.style.display;
          moonM.style.display = moonD.style.display;
        }
      });
    }
  });
</script>
