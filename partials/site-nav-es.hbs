<header class="site-header">
  <div class="global-container">

    {{!-- Desktop nav --}}
    <nav class="site-nav" aria-label="Navegacion principal">
      <a href="/es/" class="site-logo">
        <img src='{{asset "images/frame-2.svg"}}' alt="421" />
      </a>

      <div class="nav-links">
        <a href="/es/tag/cultura" class="nav-link">Cultura</a>
        <a href="/es/tag/tecnologia" class="nav-link">Tecnologia</a>
        <a href="/es/tag/juegos" class="nav-link">Juegos</a>
        <a href="/es/tag/vida-real" class="nav-link">Vida real</a>
        <a href="/es/rutas" class="nav-link">Rutas</a>
        <div class="nav-dropdown">
          <span class="nav-link" role="button" tabindex="0">MÃ¡s+</span>
          <div class="nav-dropdown-menu">
            <a href="/es/canon">Canon</a>
            <a href="/es/revista-421">Revista</a>
            <a href="/es/pitcheale-a-421/">Pitcheanos</a>
            <a href="/es/rss/">RSS</a>
          </div>
        </div>
      </div>

      <div class="nav-actions">
        <a href="/es/suscribite" class="nav-subscribe-btn">Suscribite</a>
        <button class="nav-icon-btn" data-ghost-search aria-label="Buscar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
        <a
          href="/en/"
          class="nav-icon-btn"
        >
          <img src='{{asset "images/argentina-flag.svg"}}' alt="" class="nav-flag" />
          ES
        </a>
        <button id="mode-switch" class="nav-icon-btn" aria-label="Cambiar tema">
          <img src='{{asset "images/moon.svg"}}' class="is-moon" alt="Dark mode" />
          <img src='{{asset "images/sun.svg"}}' class="is-sun" alt="Light mode" style="display:none;" />
        </button>
      </div>
    </nav>

    {{!-- Mobile nav bar --}}
    <div class="site-nav-mobile">
      <div class="nav-mobile-left">
        <button id="nav-mobile-trigger" class="nav-icon-btn" aria-label="Menu">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
        <a
          href="/en/"
          class="nav-icon-btn"
        >
          <img src='{{asset "images/argentina-flag.svg"}}' alt="" class="nav-flag" />
        </a>
      </div>
      <a href="/es/" class="site-logo site-logo--mobile">
        <img src='{{asset "images/frame-2.svg"}}' alt="421" />
      </a>
      <div class="nav-mobile-right">
        <button id="mode-switch-mobile" class="nav-icon-btn" aria-label="Cambiar tema">
          <img src='{{asset "images/moon.svg"}}' class="is-moon-m" alt="" />
          <img src='{{asset "images/sun.svg"}}' class="is-sun-m" alt="" style="display:none;" />
        </button>
        <button class="nav-icon-btn" data-ghost-search aria-label="Buscar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
      </div>
    </div>
  </div>

  {{!-- Mobile expanded menu --}}
  <nav id="nav-mobile" class="nav-mobile">
    <a href="/es/tag/cultura">Cultura</a>
    <a href="/es/tag/tecnologia">Tecnologia</a>
    <a href="/es/tag/juegos">Juegos</a>
    <a href="/es/tag/vida-real">Vida real</a>
    <a href="/es/rutas">Rutas</a>
    <a href="/es/canon">Canon</a>
    <a href="/es/revista-421" class="nav-mobile-sub">Revista</a>
    <a href="/es/pitcheale-a-421/" class="nav-mobile-sub">Pitcheanos</a>
    <a href="/es/suscribite" class="nav-mobile-subscribe">Suscribite</a>
  </nav>
</header>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Mobile menu toggle
    var mobileTrigger = document.getElementById("nav-mobile-trigger");
    var mobileMenu = document.getElementById("nav-mobile");
    if (!mobileTrigger || !mobileMenu) return;
    mobileMenu.style.display = "none";

    function toggleMobileMenu(e) {
      e.stopPropagation();
      if (mobileMenu.style.display === "none") {
        mobileTrigger.classList.add("is-open");
        mobileMenu.style.display = "flex";
      } else {
        mobileTrigger.classList.remove("is-open");
        mobileMenu.style.display = "none";
      }
    }

    if ('ontouchstart' in window) {
      mobileTrigger.addEventListener("touchstart", toggleMobileMenu, { passive: false });
    } else {
      mobileTrigger.addEventListener("click", toggleMobileMenu);
    }

    // Active link highlighting
    var currentPath = window.location.pathname;
    document.querySelectorAll('.nav-link, .nav-mobile a:not(.nav-mobile-subscribe)').forEach(function(link) {
      var href = link.getAttribute('href');
      if (href && href !== '/es/' && currentPath.startsWith(href)) {
        link.classList.add('is-active');
      }
    });

    // Smart language switch: go to EN equivalent of current page
    var enUrl = '/en/';
    var enMeta = document.querySelector('meta[name="english-version"]');
    if (enMeta && enMeta.content) {
      enUrl = '/en/' + enMeta.content + '/';
    } else {
      var langMap = {
        '/es/': '/en/',
        '/es/tag/cultura/': '/en/tag/culture/',
        '/es/tag/tecnologia/': '/en/tag/tech/',
        '/es/tag/juegos/': '/en/tag/games/',
        '/es/tag/vida-real/': '/en/tag/real-life/',
        '/es/rutas/': '/en/routes/',
        '/es/canon/': '/en/canon/',
        '/es/suscribite/': '/en/subscribe/'
      };
      var path = currentPath.replace(/\/?$/, '/');
      if (langMap[path]) enUrl = langMap[path];
    }
    document.querySelectorAll('a[href="/en/"]').forEach(function(a) {
      if (a.closest('.nav-actions') || a.closest('.nav-mobile-left')) a.href = enUrl;
    });

    // Sync mobile mode-switch with desktop
    var mobileSwitch = document.getElementById('mode-switch-mobile');
    var desktopSwitch = document.getElementById('mode-switch');
    if (mobileSwitch && desktopSwitch) {
      mobileSwitch.addEventListener('click', function(e) {
        e.preventDefault();
        desktopSwitch.click();
        var sunD = desktopSwitch.querySelector('.is-sun');
        var moonD = desktopSwitch.querySelector('.is-moon');
        var sunM = mobileSwitch.querySelector('.is-sun-m');
        var moonM = mobileSwitch.querySelector('.is-moon-m');
        if (sunD && moonD && sunM && moonM) {
          sunM.style.display = sunD.style.display;
          moonM.style.display = moonD.style.display;
        }
      });
    }
  });
</script>
