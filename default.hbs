{{#is "post"}}{{#post}}{{#has tag="#en"}}<html lang="en">{{else}}<html lang="es">{{/has}}{{/post}}{{else}}<html lang="es">{{/is}}
  <head>
    <title>{{meta_title}}</title>
    <meta charset='utf-8' />
    <meta content='width=device-width, initial-scale=1' name='viewport' />
    <link href='https://fonts.googleapis.com' rel='preconnect' />
    <link href='https://fonts.gstatic.com' rel='preconnect' crossorigin='anonymous' />
    <link href='https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,wght@0,400;0,700;1,400;1,700;1,800&family=Lora:ital,wght@0,400;0,700;1,400;1,700&display=swap' rel='stylesheet' />
    <script type='text/javascript'>
      !function(o,c) { var n = c.documentElement, t = " w-mod-"; n.className +=
      t + "js", ("ontouchstart" in o||o.DocumentTouch && c instanceof
      DocumentTouch) &&(n.className+=t+"touch") }(window,document);
    </script>
    {{#unless @site.icon}}<link
        href='{{asset "images/favicon.svg"}}'
        rel='shortcut icon'
        type='image/x-icon'
      />{{/unless}}
    {{#unless @site.icon}}
      <link href='{{asset "images/webclip.png"}}' rel='apple-touch-icon' />
    {{/unless}}
    <link href='{{asset "css/udesly-ghost.css"}}' rel='stylesheet' />
    {{!-- Server-side hreflang: homepage --}}
    {{#is "home"}}
    <link rel="alternate" hreflang="es" href="https://www.421.news/es/" />
    <link rel="alternate" hreflang="en" href="https://www.421.news/en/" />
    <link rel="alternate" hreflang="x-default" href="https://www.421.news/" />
    {{/is}}
    {{!-- Server-side hreflang: post self-referential --}}
    {{#is "post"}}{{#post}}{{#has tag="#en"}}
    <link rel="alternate" hreflang="en" href="{{url absolute=true}}" />
    {{else}}
    <link rel="alternate" hreflang="es" href="{{url absolute=true}}" />
    {{/has}}{{/post}}{{/is}}
    <script>
      (function() {
        // Set lang for collection pages (posts handled server-side)
        if (window.location.pathname.startsWith('/en/')) {
          document.documentElement.lang = 'en';
        }
      })();
    </script>
    {{ghost_head}}
    {{!-- Fix publisher logo in Ghost's Article JSON-LD: add width/height (GSC structured data error) --}}
    <script>
      (function() {
        var scripts = document.querySelectorAll('script[type="application/ld+json"]');
        for (var i = 0; i < scripts.length; i++) {
          try {
            var data = JSON.parse(scripts[i].textContent);
            if (data['@type'] === 'Article' && data.publisher && data.publisher.logo) {
              data.publisher.logo.url = 'https://www.421.news/content/images/2026/02/logo-421-publisher.png';
              data.publisher.logo.width = 125;
              data.publisher.logo.height = 60;
              scripts[i].textContent = JSON.stringify(data);
            }
          } catch(e) {}
        }
      })();
    </script>
    {{!-- Post cross-language hreflang: runs sync AFTER ghost_head injects meta tags --}}
    <script>
      (function() {
        var enMeta = document.querySelector('meta[name="english-version"]');
        var esMeta = document.querySelector('meta[name="spanish-version"]');
        if (!enMeta && !esMeta) return;
        function addHreflang(lang, href) {
          var link = document.createElement('link');
          link.rel = 'alternate'; link.hreflang = lang; link.href = href;
          document.head.appendChild(link);
        }
        if (enMeta && enMeta.content) {
          addHreflang('es', window.location.href);
          addHreflang('en', 'https://www.421.news/en/' + enMeta.content + '/');
        }
        if (esMeta && esMeta.content) {
          addHreflang('en', window.location.href);
          addHreflang('es', 'https://www.421.news/es/' + esMeta.content + '/');
        }
      })();
    </script>
    <link href='{{asset "css/normalize.css"}}' rel='stylesheet' />
    <link href='{{asset "css/globals.css"}}' rel='stylesheet' />
    <link href='{{asset "css/site-nav.css"}}' rel='stylesheet' />
    <link href='{{asset "css/index.css"}}' rel='stylesheet' />
    <link href='{{asset "css/progress-bar.css"}}' rel='stylesheet' />
    <link href='{{asset "css/file-browser.css"}}' rel='stylesheet' />
    <link href='{{asset "css/window-manager.css"}}' rel='stylesheet' />
    <script>
      (function() {
        if (window.location.pathname !== '/') return;
        if (navigator.webdriver || /bot|crawl|spider|slurp|googlebot|bingbot|yandex/i.test(navigator.userAgent)) return;
        var lang = (navigator.language || navigator.userLanguage || '').toLowerCase().split('-')[0];
        window.location.replace(lang === 'en' ? '/en/' : '/es/');
      })();
    </script>
  </head>
  <body class='{{body_class}}'>
    {{{body}}}

    {{> "sticky-subscribe-mobile-button"}}
    <script>
      (function() {
        // Update sticky subscribe button text for English pages
        if (window.location.pathname.startsWith('/en/')) {
          const subscribeButton = document.getElementById('hero-mobile-subscribe-button');
          if (subscribeButton) {
            subscribeButton.textContent = "Subscribe";
            subscribeButton.href = "/en/subscribe/";
          }
        }
      })();
    </script>
    {{> "window-manager"}}
    {{ghost_foot}}
    <script src='{{asset "js/udesly-ghost.min.js"}}' defer></script>
    <script>
      // Remove Ghost Portal subscribe CTA from bottom of posts
      (function() {
        function removePostCTA() {
          document.querySelectorAll('.gh-post-upgrade-cta').forEach(function(el) { el.remove(); });
        }
        removePostCTA();
        setTimeout(removePostCTA, 500);
        setTimeout(removePostCTA, 1500);
        setTimeout(removePostCTA, 3000);
        new MutationObserver(function(mutations) {
          mutations.forEach(function(m) {
            m.addedNodes.forEach(function(node) {
              if (node.nodeType === 1) {
                if (node.classList && node.classList.contains('gh-post-upgrade-cta')) node.remove();
                var nested = node.querySelectorAll && node.querySelectorAll('.gh-post-upgrade-cta');
                if (nested) nested.forEach(function(el) { el.remove(); });
              }
            });
          });
        }).observe(document.body || document.documentElement, { childList: true, subtree: true });
      })();
    </script>
    <script src="{{asset "js/light-mode.js"}}" defer></script>
    <script src="{{asset "js/hide-show-nav.js"}}" defer></script>
    <script src="{{asset "js/file-browser.js"}}" defer></script>
    <script src="{{asset "js/window-manager.js"}}" defer></script>
  </body>
</html>