{{!< default}}

<script>
  document.title = 'Suscribite a 421 | 421.news';
  (function() {
    var title = 'Suscribite a 421 | 421.news';
    var desc = '421 es un medio de orientación intelectual. Suscribite para acceder a todo el contenido.';
    var img = 'https://www.421.news/content/images/2026/01/10_diciembre.jpg';
    var url = 'https://www.421.news/es/suscribite/';
    function setMeta(attr, key, val) {
      var el = document.querySelector('meta[' + attr + '="' + key + '"]');
      if (el) { el.content = val; }
      else { var m = document.createElement('meta'); m.setAttribute(attr, key); m.content = val; document.head.appendChild(m); }
    }
    setMeta('name', 'description', desc);
    setMeta('property', 'og:title', title);
    setMeta('property', 'og:description', desc);
    setMeta('property', 'og:image', img);
    setMeta('property', 'og:url', url);
    setMeta('property', 'og:type', 'website');
    setMeta('name', 'twitter:card', 'summary_large_image');
    setMeta('name', 'twitter:title', title);
    setMeta('name', 'twitter:description', desc);
    setMeta('name', 'twitter:image', img);
  })();
</script>

    <link href="{{asset "css/suscribite.css"}}" rel="stylesheet" type="text/css">
    <div class="page-wrapper">
      {{> "general-styling"}}
      {{> "site-nav-es"}}

      <div class="sub-page">
        <div class="sub-container">

          <!-- ===== SECTION 1: HERO + PLAN ===== -->
          <div id="sub-section-plan">

            <div class="sub-hero">
              <h1 class="sub-hero-title">&iexcl;Sumate!</h1>
              <p class="sub-hero-subtitle">421 es un medio de orientaci&oacute;n intelectual para navegar un mundo saturado de tecnolog&iacute;a, im&aacute;genes y discursos. Nuestro objetivo es ayudarte a navegar mejor en un mundo que te pasa por arriba.</p>
              <p class="sub-hero-callout">Tu aporte econ&oacute;mico es esencial para la subsistencia del proyecto.</p>
            </div>
            <hr class="sub-gradient-divider">

            <div class="sub-card" id="sub-plan-card">
              <div class="plan-toggle">
                <button class="plan-toggle-btn" id="toggle-monthly">Mensual</button>
                <button class="plan-toggle-btn active" id="toggle-yearly">
                  Anual
                  <span class="toggle-badge">-17%</span>
                </button>
              </div>

              <div id="plan-price">
                <div class="plan-price-row">
                  <span class="plan-price-big" id="price-amount">...</span>
                  <span class="plan-price-period" id="price-period">USD / a&ntilde;o</span>
                </div>
                <div class="plan-price-detail" id="price-detail"></div>
                <div class="plan-price-ars" id="price-ars" style="display:none;"></div>
              </div>

              <ul class="plan-benefits">
                <li>Newsletter mensual premium</li>
                <li>Edici&oacute;n digital de la Revista 421</li>
                <li>Invitaciones a eventos AFK</li>
              </ul>

              <button class="btn-gradient" id="btn-suscribirme">Suscribirme</button>
            </div>

            <div class="free-tier-link">
              <p style="font-size: var(--fs-lg);">&iquest;S&oacute;lo quer&eacute;s recibir nuestro newsletter?</p>
              <button class="btn-outline" id="btn-free">Registrate gratis</button>
            </div>
          </div>

          <!-- ===== SECTION 2: PAYMENT METHOD CHOOSER ===== -->
          <div id="sub-section-chooser" style="display: none;">

            <div class="sub-hero">
              <h1 class="sub-hero-title">Eleg&iacute; c&oacute;mo pagar</h1>
            </div>
            <hr class="sub-gradient-divider">

            <div class="sub-card" style="max-width: 600px;">
              <div class="sub-card-label" id="chooser-plan-name"></div>

              <div class="payment-methods">
                <button class="payment-method-btn" id="btn-stripe">
                  <span class="payment-method-icon">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                      <rect width="40" height="40" rx="8" fill="#635BFF"/>
                      <path d="M18.5 16.5c0-.83.68-1.15 1.81-1.15 1.62 0 3.67.49 5.29 1.37V11.8c-1.77-.7-3.52-.98-5.29-.98-4.33 0-7.21 2.26-7.21 6.04 0 5.89 8.11 4.95 8.11 7.49 0 .98-.85 1.3-2.05 1.3-1.77 0-4.04-.73-5.83-1.71v4.98c1.98.85 3.99 1.22 5.83 1.22 4.43 0 7.48-2.19 7.48-6.02-.02-6.36-8.14-5.23-8.14-7.62z" fill="white"/>
                    </svg>
                  </span>
                  <span class="payment-method-name">Stripe</span>
                  <span class="payment-method-desc">Tarjeta internacional (USD)</span>
                </button>

                <button class="payment-method-btn" id="btn-mp">
                  <span class="payment-method-icon">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="#00AEEF">
                      <path d="M11.115 16.479a.93.927 0 0 1-.939-.886c-.002-.042-.006-.155-.103-.155-.04 0-.074.023-.113.059-.112.103-.254.206-.46.206a.816.814 0 0 1-.305-.066c-.535-.214-.542-.578-.521-.725.006-.038.007-.08-.02-.11l-.032-.03h-.034c-.027 0-.055.012-.093.039a.788.786 0 0 1-.454.16.7.699 0 0 1-.253-.05c-.708-.27-.65-.928-.617-1.126.005-.041-.005-.072-.03-.092l-.05-.04-.047.043a.728.726 0 0 1-.505.203.73.728 0 0 1-.732-.725c0-.4.328-.722.732-.722.364 0 .675.27.721.63l.026.195.11-.165c.01-.018.307-.46.852-.46.102 0 .21.016.316.05.434.13.508.52.519.68.008.094.075.1.09.1.037 0 .064-.024.083-.045a.746.744 0 0 1 .54-.225c.128 0 .263.03.402.09.69.293.379 1.158.374 1.167-.058.144-.061.207-.005.244l.027.013h.02c.03 0 .07-.014.134-.035.093-.032.235-.08.367-.08a.944.942 0 0 1 .94.93.936.934 0 0 1-.94.928zm7.302-4.171c-1.138-.98-3.768-3.24-4.481-3.77-.406-.302-.685-.462-.928-.533a1.559 1.554 0 0 0-.456-.07c-.182 0-.376.032-.58.095-.46.145-.918.505-1.362.854l-.023.018c-.414.324-.84.66-1.164.73a1.986 1.98 0 0 1-.43.049c-.362 0-.687-.104-.81-.258-.02-.025-.007-.066.04-.125l.008-.008 1-1.067c.783-.774 1.525-1.506 3.23-1.545h.085c1.062 0 2.12.469 2.24.524a7.03 7.03 0 0 0 3.056.724c1.076 0 2.188-.263 3.354-.795a9.135 9.11 0 0 0-.405-.317c-1.025.44-2.003.66-2.946.66-.962 0-1.925-.229-2.858-.68-.05-.022-1.22-.567-2.44-.57-.032 0-.065 0-.096.002-1.434.033-2.24.536-2.782.976-.528.013-.982.138-1.388.25-.361.1-.673.186-.979.185-.125 0-.35-.01-.37-.012-.35-.01-2.115-.437-3.518-.962-.143.1-.28.203-.415.31 1.466.593 3.25 1.053 3.812 1.089.157.01.323.027.491.027.372 0 .744-.103 1.104-.203.213-.059.446-.123.692-.17l-.196.194-1.017 1.087c-.08.08-.254.294-.14.557a.705.703 0 0 0 .268.292c.243.162.677.27 1.08.271.152 0 .297-.015.43-.044.427-.095.874-.448 1.349-.82.377-.296.913-.672 1.323-.782a1.494 1.49 0 0 1 .37-.05.611.61 0 0 1 .095.005c.27.034.533.125 1.003.472.835.62 4.531 3.815 4.566 3.846.002.002.238.203.22.537-.007.186-.11.352-.294.466a.902.9 0 0 1-.484.15.804.802 0 0 1-.428-.124c-.014-.01-1.28-1.157-1.746-1.543-.074-.06-.146-.115-.22-.115a.122.122 0 0 0-.096.045c-.073.09.01.212.105.294l1.48 1.47c.002 0 .184.17.204.395.012.244-.106.447-.35.606a.957.955 0 0 1-.526.171.766.764 0 0 1-.42-.127l-.214-.206a21.035 20.978 0 0 0-1.08-1.009c-.072-.058-.148-.112-.221-.112a.127.127 0 0 0-.094.038c-.033.037-.056.103.028.212a.698.696 0 0 0 .075.083l1.078 1.198c.01.01.222.26.024.511l-.038.048a1.18 1.178 0 0 1-.1.096c-.184.15-.43.164-.527.164a.8.798 0 0 1-.147-.012c-.106-.018-.178-.048-.212-.089l-.013-.013c-.06-.06-.602-.609-1.054-.98-.059-.05-.133-.11-.21-.11a.128.128 0 0 0-.096.042c-.09.096.044.24.1.293l.92 1.003a.204.204 0 0 1-.033.062c-.033.044-.144.155-.479.196a.91.907 0 0 1-.122.007c-.345 0-.712-.164-.902-.264a1.343 1.34 0 0 0 .13-.576 1.368 1.365 0 0 0-1.42-1.357c.024-.342-.025-.99-.697-1.274a1.455 1.452 0 0 0-.575-.125c-.146 0-.287.025-.42.075a1.153 1.15 0 0 0-.671-.564 1.52 1.515 0 0 0-.494-.085c-.28 0-.537.08-.767.242a1.168 1.165 0 0 0-.903-.43 1.173 1.17 0 0 0-.82.335c-.287-.217-1.425-.93-4.467-1.613a17.39 17.344 0 0 1-.692-.189 4.822 4.82 0 0 0-.077.494l.67.157c3.108.682 4.136 1.391 4.309 1.525a1.145 1.142 0 0 0-.09.442 1.16 1.158 0 0 0 1.378 1.132c.096.467.406.821.879 1.003a1.165 1.162 0 0 0 .415.08c.09 0 .179-.012.266-.034.086.22.282.493.722.668a1.233 1.23 0 0 0 .457.094c.122 0 .241-.022.355-.063a1.373 1.37 0 0 0 1.269.841c.37.002.726-.147.985-.41.221.121.688.341 1.163.341.06 0 .118-.002.175-.01.47-.059.689-.24.789-.382a.571.57 0 0 0 .048-.078c.11.032.234.058.373.058.255 0 .501-.086.75-.265.244-.174.418-.424.444-.637v-.01c.083.017.167.026.251.026.265 0 .527-.082.773-.242.48-.31.562-.715.554-.98a1.28 1.279 0 0 0 .978-.194 1.04 1.04 0 0 0 .502-.808 1.088 1.085 0 0 0-.16-.653c.804-.342 2.636-1.003 4.795-1.483a4.734 4.721 0 0 0-.067-.492 27.742 27.667 0 0 0-5.049 1.62zm5.123-.763c0 4.027-5.166 7.293-11.537 7.293-6.372 0-11.538-3.266-11.538-7.293 0-4.028 5.165-7.293 11.539-7.293 6.371 0 11.537 3.265 11.537 7.293zm.46.004c0-4.272-5.374-7.755-12-7.755S.002 7.277.002 11.55L0 12.004c0 4.533 4.695 8.203 11.999 8.203 7.347 0 12-3.67 12-8.204z"/>
                    </svg>
                  </span>
                  <span class="payment-method-name">MercadoPago</span>
                  <span class="payment-method-desc">Pesos argentinos</span>
                </button>
              </div>

              <p class="payment-method-note">
                Stripe cobra en USD. MercadoPago cobra en pesos argentinos.
              </p>
            </div>

            <button class="btn-back" id="btn-back-plan">&#8592; Volver a planes</button>
          </div>

          <!-- ===== SECTION 3: MERCADOPAGO FORM ===== -->
          <div id="sub-section-mp" style="display: none;">

            <div class="sub-hero">
              <h1 class="sub-hero-title">Complet&aacute; tu suscripci&oacute;n</h1>
            </div>
            <hr class="sub-gradient-divider">

            <div class="sub-card">
              <div class="sub-card-label" id="mp-plan-name"></div>

              <form id="mp-form">
                <input type="hidden" id="mp-sub-type" value="">
                <div class="form-group">
                  <label for="mp-name">Nombre completo</label>
                  <input type="text" id="mp-name" name="name" required placeholder="Tu nombre">
                </div>
                <div class="form-group">
                  <label for="mp-email">Correo electr&oacute;nico</label>
                  <input type="email" id="mp-email" name="email" required placeholder="tu@email.com">
                </div>
                <p class="form-note">El mail tiene que ser el mismo de la cuenta de MercadoPago.</p>
                <button type="submit" class="btn-solid" id="mp-submit-btn">Ir a MercadoPago</button>
              </form>
              <div id="mp-form-message" class="form-message"></div>
            </div>

            <button class="btn-back" id="btn-back-chooser">&larr; Cambiar m&eacute;todo de pago</button>
          </div>

        </div>
      </div>

      {{> "site-footer"}}
    </div>

    <script defer>
      document.addEventListener('DOMContentLoaded', function() {
        // State
        var currentCadence = 'yearly';
        var tierData = null;
        var blueRate = null;

        // DOM refs
        var sectionPlan = document.getElementById('sub-section-plan');
        var sectionChooser = document.getElementById('sub-section-chooser');
        var sectionMp = document.getElementById('sub-section-mp');

        // Fetch tiers from Content API
        fetch('/ghost/api/content/tiers/?key=420da6f85b5cc903b347de9e33')
          .then(function(r) { return r.json(); })
          .then(function(data) {
            var tiers = data.tiers || [];
            for (var i = 0; i < tiers.length; i++) {
              if (tiers[i].type === 'paid' && tiers[i].active) {
                tierData = tiers[i];
                break;
              }
            }
            if (tierData) updatePriceDisplay();
          });

        // Fetch blue dollar rate
        fetch('https://dolarapi.com/v1/dolares/blue')
          .then(function(r) { return r.json(); })
          .then(function(data) {
            if (data && data.venta) {
              blueRate = data.venta;
              updatePriceDisplay();
            }
          })
          .catch(function() { /* silently fail — USD price stays visible */ });

        function formatPrice(cents) {
          var dollars = cents / 100;
          return '$' + (dollars % 1 === 0 ? dollars : dollars.toFixed(2));
        }

        function formatARS(amount) {
          return '$' + Math.round(amount).toLocaleString('es-AR');
        }

        function updatePriceDisplay() {
          if (!tierData) return;
          var amountEl = document.getElementById('price-amount');
          var periodEl = document.getElementById('price-period');
          var detailEl = document.getElementById('price-detail');
          var arsEl = document.getElementById('price-ars');

          if (currentCadence === 'yearly') {
            amountEl.textContent = formatPrice(tierData.yearly_price);
            periodEl.textContent = 'USD / a\u00f1o';
            var monthlyTotal = tierData.monthly_price * 12;
            detailEl.innerHTML = '<span class="striked">' + formatPrice(monthlyTotal) + '</span> \u2014 ahorra 2 meses';
          } else {
            amountEl.textContent = formatPrice(tierData.monthly_price);
            periodEl.textContent = 'USD / mes';
            detailEl.textContent = 'Sin compromiso, cancela cuando quieras';
          }

          // Show ARS equivalent if blue rate available
          if (blueRate && arsEl) {
            var usdCents = currentCadence === 'yearly' ? tierData.yearly_price : tierData.monthly_price;
            var usd = usdCents / 100;
            var ars = usd * blueRate;
            var period = currentCadence === 'yearly' ? 'a\u00f1o' : 'mes';
            arsEl.innerHTML = '\u2248 ' + formatARS(ars) + ' ARS/' + period + ' con MercadoPago';
            arsEl.style.display = 'block';
          }
        }

        function showSection(section) {
          sectionPlan.style.display = 'none';
          sectionChooser.style.display = 'none';
          sectionMp.style.display = 'none';
          section.style.display = 'block';
          window.scrollTo(0, 0);
        }

        function getPlanLabel() {
          if (!tierData) return '';
          if (currentCadence === 'yearly') {
            return 'Wizard Anual \u2014 ' + formatPrice(tierData.yearly_price) + ' USD/a\u00f1o';
          }
          return 'Wizard Mensual \u2014 ' + formatPrice(tierData.monthly_price) + ' USD/mes';
        }

        // Toggle monthly/yearly
        var toggleM = document.getElementById('toggle-monthly');
        var toggleY = document.getElementById('toggle-yearly');

        toggleM.addEventListener('click', function() {
          currentCadence = 'monthly';
          toggleM.classList.add('active');
          toggleY.classList.remove('active');
          updatePriceDisplay();
        });

        toggleY.addEventListener('click', function() {
          currentCadence = 'yearly';
          toggleY.classList.add('active');
          toggleM.classList.remove('active');
          updatePriceDisplay();
        });

        // Suscribirme → show payment chooser
        document.getElementById('btn-suscribirme').addEventListener('click', function() {
          document.getElementById('chooser-plan-name').textContent = getPlanLabel();
          showSection(sectionChooser);
        });

        // Free signup → Ghost Portal
        document.getElementById('btn-free').addEventListener('click', function() {
          window.location.hash = '#/portal/signup/free';
        });

        // Stripe → Ghost Portal with tier
        document.getElementById('btn-stripe').addEventListener('click', function() {
          if (!tierData) return;
          window.location.hash = '#/portal/signup/' + tierData.id + '/' + currentCadence;
        });

        // MercadoPago → show form
        document.getElementById('btn-mp').addEventListener('click', function() {
          document.getElementById('mp-plan-name').textContent = getPlanLabel() + ' \u2014 MercadoPago';
          document.getElementById('mp-sub-type').value = currentCadence === 'yearly' ? 'wizard-yearly' : 'wizard-monthly';
          showSection(sectionMp);
        });

        // Back buttons
        document.getElementById('btn-back-plan').addEventListener('click', function() {
          showSection(sectionPlan);
        });
        document.getElementById('btn-back-chooser').addEventListener('click', function() {
          showSection(sectionChooser);
        });

        // MP form submit
        document.getElementById('mp-form').addEventListener('submit', function(e) {
          e.preventDefault();
          var msg = document.getElementById('mp-form-message');
          var btn = document.getElementById('mp-submit-btn');
          msg.textContent = 'Procesando...';
          msg.className = 'form-message';
          btn.disabled = true;
          btn.textContent = 'Procesando...';

          fetch('https://mercadopago-ghost.onrender.com/subscribe', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              formSubType: document.getElementById('mp-sub-type').value,
              formName: document.getElementById('mp-name').value,
              formEmail: document.getElementById('mp-email').value
            })
          })
          .then(function(r) {
            if (!r.ok) throw new Error('Error del servidor');
            return r.json();
          })
          .then(function(data) {
            if (data.success && data.redirectUrl) {
              window.location.href = data.redirectUrl;
            } else {
              throw new Error(data.message || 'Error al procesar');
            }
          })
          .catch(function(err) {
            msg.textContent = 'Error al procesar la suscripci\u00f3n. Intent\u00e1 nuevamente.';
            msg.className = 'form-message error';
            btn.disabled = false;
            btn.textContent = 'Ir a MercadoPago';
          });
        });
      });
    </script>
